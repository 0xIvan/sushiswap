generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

enum Protocol {
  Sushiswap
  Quickswap // quickswap06 subgraph
  Uniswap
}

enum AAMVersion {
  V2
  V3
  TRIDENT
}

model Token {
  address  String 
  network  String
  chainId  String
  name     String // TODO: constraints? if subgraph would return "", "", 0? success false?
  symbol   String
  decimals Int
  
  generatedAt DateTime @default(now())

  price  TokenPrice?
  pools0 Pool[]      @relation("token0")
  pools1 Pool[]      @relation("token1")

  @@id([network, address])
  @@index(fields: [address, network, name, symbol])
}

model TokenPrice {
  address  String 
  network       String
  chainId       String
  derivedNative Decimal
  lastUsdPrice  Decimal

  generatedAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  token         Token   @relation(fields: [network, address], references: [network, address])
  @@id([network, address])
  @@index(fields: [address, network])
}

model Pool {
  address       String
  network  String
  chainId  String
  protocol Protocol
  version  AAMVersion
  token0   Token      @relation("token0", fields: [network, token0Id], references: [network, address])
  token0Id String
  token1   Token      @relation("token1", fields: [network, token1Id], references: [network, address])
  token1Id String

  swapFee     Float?
  twapEnabled Boolean?

  reserve0        BigInt // Liquidity of token0
  reserve1        BigInt // Liquidity of token1
  totalSupply     BigInt // Liquidity, Total supply of all LP in this pool
  liquidityUSD    Decimal // liquidity in USD
  liquiditynative Decimal // liquidity in native

  volumeUSD    Decimal // volume in USD
  volumeNative Decimal // volume in native

  token0Price Decimal // Price of token0 in token1
  token1Price Decimal // Price of token1 in token0

  createdAtTimestamp   DateTime
  createdAtBlockNumber BigInt
  generatedAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([network, address])
  @@index([token0Id, token1Id, address, network])
}

// model Token {
//   id    String     @id
//   name String // TODO: default values here? if subgraph would return "", "", 0? success false?
//   symbol String
//   decimals Int
// }

// TOKEN AND POOLS

// _generatedAtTimestamp

// IDEAS:

// TokenProtocol
// network, 
