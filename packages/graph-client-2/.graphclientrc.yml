sources:

  - name: xSUSHI
    handler:
      graphql:
        endpoint: https://api.thegraph.com/subgraphs/name/sushi-labs/xsushi
        retry: 3
    # transforms:

  - name: BentoBox
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:matthewlilley/bentobox-ethereum}
        retry: 3
    # transforms:

  - name: Blocks
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:blocklytics/ethereum-blocks}
        retry: 3
    transforms:

  - name: Exchange
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:sushiswap/exchange-ethereum}
        retry: 3
    transforms:
      # - addSourceName: true
      - autoPagination:
          if: false
          validateSchema: false
      - prefix:
          value: deprecated_
          includeRootOperations: true
          includeTypes: true

  - name: SushiSwap
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:subgraph-qa/sushiswap-ethereum}
        retry: 3
    transforms:
      # - addSourceName: true
      # - autoPagination:
      #     validateSchema: true
      # transforms:
        # Rename type names and field names to let stitching merger merges them
        # - rename:
        #     renames:
        #       - from:
        #           type: PairWithIncentives
        #         to:
        #           type: Pair
        #       - from:
        #           type: Query
        #           field: pairWithIncentives
        #         to:
        #           type: Query
        #           field: pair
        #       - from:
        #           type: Query
        #           field: pairsWithIncentives
        #         to:
        #           type: Query
        #           field: pairs
        # - typeMerging:
        #     queryFields:
        #       - queryFieldName: incentives
        #         keyField: id
        #       - queryFieldName: pairs
        #         keyField: id

  - name: Trident
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:sushi-qa/trident-optimism}
        retry: 3
    transforms:

  - name: MasterChefV1
    handler:
      graphql:
        endpoint: https://{context.subgraphHost:api.thegraph.com/subgraphs/name}/{context.subgraphName:jiro-ono/masterchef-staging}
        retry: 3
    transforms:
      - addSourceName: true
      - autoPagination:
          validateSchema: true
      - prefix:
          value: MASTERCHEF_V1_
          includeRootOperations: true
          includeTypes: false
          ignore: 
            - _SubgraphErrorPolicy_  
      - rename:
          mode: wrap
          renames:
            - from:
                type:   Pool
                field:  owner
              to:
                type:   Pool
                field:  masterChef
            - from:
                type:   Pool
                field:  balance
              to:
                type:   Pool
                field:  slpBalance

  - name: MasterChefV2
    handler:
      graphql:
        endpoint: https://api.thegraph.com/subgraphs/name/sushiswap/master-chefv2
        retry: 3
    transforms:
      - addSourceName: true
      - autoPagination:
          validateSchema: true
      - prefix:
          value: MASTERCHEF_V2_
          includeRootOperations: true
          includeTypes: false
          ignore: 
            - _SubgraphErrorPolicy_

  - name: Farm
    handler:
      jsonSchema:
        baseUrl: http://localhost:3000/api/v1
        operations:
          - type: Query
            field: farms
            path: /
            method: GET
            responseSample: ./json-samples/farms.json
            responseSchema: ./json-schemas/farms.json
    transforms:

  # - name: Price
  #   handler:
  #     jsonSchema:
  #       baseUrl: https://token-price.sushi.com/v0/1
  #       operations:
  #         - type: Query
  #           field: prices
  #           path: /
  #           method: GET
  #           responseSample: ./json-samples/prices.json
  #           responseSchema: ./json-schemas/prices.json
  
# Had to disable global transforms since we have a jsonSchema handler in here now...
transforms:
  - autoPagination:
      validateSchema: false
  - autoTypeMerging: true
  - addSourceName: true

additionalTypeDefs: |
  # Types
  type UserWithFarm {
    id: ID!
    unstakedBalance: BigInt!
    stakedBalance: BigInt!
    valueUSD: BigDecimal!
    pair: Pair!
    chainId: Int!
    chainName: String!
  }
  type ChefUserPool {
    id: BigInt!
    pair: String!
  }
  type ChefUser {
    id: ID!
    chainId: Int!
    chainName: String!
    address: String!
    amount: BigInt!
    pool: ChefUserPool
  }  
  type Incentive {
    id: ID!
    apr: Int!
  }
  type PairWithIncentives {
    id: ID!
    incentives: [Incentive!]!
  }
  # Type Extensions
  extend type Block {
    chainId: Int!
  }
  extend type Bundle {
    chainId: Int!
  }
  extend type Factory {
    chainId: Int!
  }
  extend type Rebase {
    chainId: Int!
  }
  extend type Token {
    chainId: Int!
  }  
  extend type Pair {
    chainId: Int!
  }
  extend type LiquidityPosition {
    chainId: Int!
  }
  # Deprecated 
  extend type deprecated_Token {
    chainId: Int!
  }
  extend type deprecated_Pair {
    chainId: Int!
  }
  extend type deprecated_LiquidityPosition {
    chainId: Int!
  }
  # Query Extensions
  extend type Query {
    crossChainBlocks(
      skip: Int = 0
      first: Int = 100
      where: Block_filter
      orderBy: Block_orderBy
      orderDirection: OrderDirection
      chainIds: [Int!]!
    ): [Block!]!
    oneDayBlocks(
      skip: Int = 0
      first: Int = 100
      chainIds: [Int!]!
    ): [Block!]!
    twoDayBlocks(
      skip: Int = 0
      first: Int = 100
      chainIds: [Int!]!
    ): [Block!]!
    oneWeekBlocks(
      skip: Int = 0
      first: Int = 100
      chainIds: [Int!]!
    ): [Block!]!
    customBlocks(
      skip: Int = 0
      first: Int = 100
      timestamp: Int!
      chainIds: [Int!]!
    ): [Block!]!
    crossChainChefUser(
      skip: Int = 0
      first: Int = 100
      where: User_filter
      orderBy: User_orderBy
      orderDirection: OrderDirection
      block: Block_height
      chainIds: [Int!]!
    ): [ChefUser!]!
    crossChainRebases(
      skip: Int = 0
      first: Int = 100
      where: Rebase_filter
      chainIds: [Int!]!
    ): [Rebase!]!
    crossChainBundles(
      chainIds: [Int!]!
    ): [Bundle!]!
    crossChainFactories(
      chainIds: [Int!]!
    ): [Factory!]!
    crossChainPair(
      id: ID!
      chainId: Int!
    ): Pair
    crossChainPairs(
      skip: Int = 0
      first: Int = 100
      where: Pair_filter
      orderBy: Pair_orderBy
      orderDirection: OrderDirection
      block: Block_height
      chainIds: [Int!]!
    ): [Pair!]!
    crossChainPairsWithFarms(
      skip: Int = 0
      first: Int = 100
      where: Pair_filter
      orderBy: Pair_orderBy
      orderDirection: OrderDirection
      block: Block_height
      chainIds: [Int!]!
    ): [Pair!]!
    crossChainLiquidityPositions(
      skip: Int = 0
      first: Int = 100
      where: LiquidityPosition_filter
      orderBy: LiquidityPosition_orderBy
      orderDirection: OrderDirection
      block: Block_height
      chainIds: [Int!]!
    ): [LiquidityPosition!]!
    crossChainUserWithFarms(
      id: ID!
      chainIds: [Int!]!
      block: Block_height
    ): [UserWithFarm!]
    # pairWithIncentives(
    #   id: ID!
    # ): PairWithIncentives!
    # pairsWithIncentives(
    #   ids: [ID!]
    #   skip: Int = 0
    #   first: Int = 100
    #   where: Pair_filter
    #   orderBy: Pair_orderBy
    #   orderDirection: OrderDirection
    #   chainIds: [Int!]!
    # ): [PairWithIncentives!]!
  }

additionalResolvers:
  - resolvers/index.js
  
documents:
  - queries/bentobox.graphql
  - queries/blocks.graphql
  - queries/bundles.graphql
  - queries/deprecated.graphql
  - queries/factories.graphql
  - queries/liquidity-positions.graphql
  - queries/masterchef.graphql
  - queries/pairs.graphql
  - queries/tokens.graphql
  - queries/user.graphql
  - queries/xsushi.graphql
  - queries/farms.graphql

serve:
  playground: true

codegen:
  contextType: 'MeshContext & { chainId: string; subgraphName: string; subgraphHost: string }'